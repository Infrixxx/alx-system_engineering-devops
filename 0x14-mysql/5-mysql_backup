#!/usr/bin/env bash
# MySQL backup script

# Check if the correct number of arguments is provided
if [ "$#" -ne 1 ]; then
    echo "Usage: $0 <mysql_password>"
    exit 1
fi

# MySQL user (assuming root with no password)
MYSQL_USER="root"
MYSQL_PASSWORD="$1"

# Directory to store backups (replace /path/to/backup/directory with the actual path)
BACKUP_DIR="/path/to/backup/directory"

# Ensure the backup directory exists
mkdir -p "$BACKUP_DIR"

# Create a timestamp for the backup file
TIMESTAMP=$(date +'%d-%m-%Y')

# MySQL dump command
mysqldump -u"$MYSQL_USER" -p"$MYSQL_PASSWORD" --all-databases > "$BACKUP_DIR/backup.sql"

# Check if mysqldump was successful
if [ $? -ne 0 ]; then
    echo "MySQL dump failed. Exiting."
    exit 1
fi

# Create a tar-gzipped archive
tar -czvf "$BACKUP_DIR/$TIMESTAMP.tar.gz" -C "$BACKUP_DIR" backup.sql

# Check if tar was successful
if [ $? -ne 0 ]; then
    echo "Creating archive failed. Exiting."
    exit 1
fi

# Cleanup: remove the temporary MySQL dump
rm "$BACKUP_DIR/backup.sql"

echo "Backup completed successfully."
